<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-how_it_works" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">How it works | Cloudstack</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lefterisALEX.github.io/kickstart-selfhosted-pages/img/&lt;open-graph-card&gt;"><meta data-rh="true" name="twitter:image" content="https://lefterisALEX.github.io/kickstart-selfhosted-pages/img/&lt;open-graph-card&gt;"><meta data-rh="true" property="og:url" content="https://lefterisALEX.github.io/kickstart-selfhosted-pages/how_it_works"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="How it works | Cloudstack"><meta data-rh="true" name="description" content="General idea"><meta data-rh="true" property="og:description" content="General idea"><link data-rh="true" rel="icon" href="/kickstart-selfhosted-pages/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lefterisALEX.github.io/kickstart-selfhosted-pages/how_it_works"><link data-rh="true" rel="alternate" href="https://lefterisALEX.github.io/kickstart-selfhosted-pages/how_it_works" hreflang="en"><link data-rh="true" rel="alternate" href="https://lefterisALEX.github.io/kickstart-selfhosted-pages/how_it_works" hreflang="x-default"><link rel="stylesheet" href="/kickstart-selfhosted-pages/assets/css/styles.76118980.css">
<script src="/kickstart-selfhosted-pages/assets/js/runtime~main.35630bec.js" defer="defer"></script>
<script src="/kickstart-selfhosted-pages/assets/js/main.9569de66.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/kickstart-selfhosted-pages/"><b class="navbar__title text--truncate">Cloustack</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" sidebarid="docsSidebar" href="/kickstart-selfhosted-pages/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/lefterisALEX/kickstart-selfhosted-pages" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kickstart-selfhosted-pages/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/kickstart-selfhosted-pages/how_it_works">How it works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kickstart-selfhosted-pages/costs">Costs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kickstart-selfhosted-pages/category/preparation">Preparation</a><button aria-label="Expand sidebar category &#x27;Preparation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kickstart-selfhosted-pages/configuration-options">Configuration Options</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kickstart-selfhosted-pages/deploy-cloudstack">Deploy Cloudstack</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kickstart-selfhosted-pages/category/operations">Operations</a><button aria-label="Expand sidebar category &#x27;Operations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/kickstart-selfhosted-pages/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">How it works</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How it works</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="general-idea">General idea<a href="#general-idea" class="hash-link" aria-label="Direct link to General idea" title="Direct link to General idea">​</a></h2>
<p>The objective is to establish a fully automated deployment process that provisions all necessary infrastructure and containers as specified in the docker-compose.yaml files through a continuous integration/continuous deployment (CI/CD) pipeline. Aside from a few manual steps outlined in the Preparation section, all configurations will be defined in code.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="containers-deployment">Containers Deployment<a href="#containers-deployment" class="hash-link" aria-label="Direct link to Containers Deployment" title="Direct link to Containers Deployment">​</a></h2>
<p>When the setup is deployed a VPS will be launched in Hetzner were your containers will run.
In this VPS your github repository will be also cloned under <code>/root/deployr/</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployr-script">Deployr script<a href="#deployr-script" class="hash-link" aria-label="Direct link to Deployr script" title="Direct link to Deployr script">​</a></h3>
<p>The deployr script is executed periodically (every 3 minutes) and taking care of the following actions:</p>
<ol>
<li>Fetch latest code from your repository.</li>
<li>Fetch all secrets from your infisical project and save them locally in the VPS (see Secrets section below for more info)</li>
<li>If there is any new commit detected then <code>docker compose up -d /root/deployr/containers-host/apps/docker-compose.yaml</code> is executed</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-compose-structure">Docker-compose structure<a href="#docker-compose-structure" class="hash-link" aria-label="Direct link to Docker-compose structure" title="Direct link to Docker-compose structure">​</a></h3>
<p>Instead of having a large <code>docker-compose.yaml</code> file where we define all the services, we use instead the <code>include</code> command to split the configuration in multiple files.</p>
<p>Below a structure of the folder <code>containers-host/apps</code> in your repository.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── docker-compose.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── traefik</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   └── docker-compose.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└── uptime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    └── docker-compose.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="root-docker-compose-file">root docker-compose file<a href="#root-docker-compose-file" class="hash-link" aria-label="Direct link to root docker-compose file" title="Direct link to root docker-compose file">​</a></h4>
<p>In this structure there is a main <code>docker-compose.yaml</code> file which is used to configure:</p>
<ol>
<li>Which other <code>docker-compose.yaml</code> files should be included, so in other words which other services should be enabled.</li>
<li>The docker network name and subnet.</li>
</ol>
<p>example of a root <code>docker-compose.yaml</code> file</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">version: &quot;3&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">include:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - ./traefik/docker-compose.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - ./docker-backup/docker-compose.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - ./dashy/docker-compose.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - ./uptime/docker-compose.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">networks:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  private_network:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name: private_network</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    driver: bridge</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ipam:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      config:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - subnet: 172.29.1.0/24</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="application-specific-docker-compose-file">application specific docker-compose file<a href="#application-specific-docker-compose-file" class="hash-link" aria-label="Direct link to application specific docker-compose file" title="Direct link to application specific docker-compose file">​</a></h4>
<p>All applications in this example (traefik/docker-backup/dashy/uptime) should have then their own dedicated  <code>docker-compose.yaml</code> file under a specific directory.<br>
<!-- -->For instance for the traefik application the <code>docker-compose.yaml</code> is the <code>traefik/docker-compose.yaml</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">version: &quot;3.8&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">name: traefik</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  traefik:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: traefik:v3.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    container_name: traefik</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - 80:80</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - 443:443</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - 8080:8080</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    networks:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      private_network:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    env_file:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - .secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - /var/run/docker.sock:/var/run/docker.sock:ro</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - /mnt/data/traefik/letsencrypt:/letsencrypt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    command:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;--api=true&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;--api.dashboard=true&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;--providers.docker=true&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;--providers.docker.exposedbydefault=false&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;--entrypoints.web.address=:80&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;--entrypoints.websecure.address=:443&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;--entrypoints.web.http.redirections.entryPoint.to=websecure&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;--certificatesresolvers.letsencrypt.acme.dnschallenge=true&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;--certificatesresolvers.letsencrypt.acme.dnschallenge.provider=cloudflare&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;--certificatesresolvers.letsencrypt.acme.email=${EMAIL}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;--certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;traefik.enable=true&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;traefik.http.routers.dashboard.entrypoints=websecure&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;traefik.http.routers.dashboard.tls.certresolver=letsencrypt&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;traefik.http.routers.dashboard.rule=Host(`dashboard.${DOMAIN}`) &amp;&amp; (PathPrefix(`/api`) || PathPrefix(`/dashboard`))&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;traefik.http.routers.dashboard.service=api@internal&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    restart: always</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="persistent-storage">Persistent Storage<a href="#persistent-storage" class="hash-link" aria-label="Direct link to Persistent Storage" title="Direct link to Persistent Storage">​</a></h2>
<p>The setup provision a volume in Hetzner which is attached in the VPS under <code>/mnt/data</code>. Any data that need to persist is highly recommeneded to be stored there.
This can be done by mounting the path inside the container under <code>/mnt/data/application_name</code>.<br>
<!-- -->By storing persistent data in an external volume, the data remains unaffected by the lifecycle of the VPS. This means that if the VPS is replaced, the data in the external volume will not be lost. Additionally, the external volume comes with delete protection enabled by default, ensuring that it cannot be deleted without first disabling this protection.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>It is not necessary to store application-specific persistent data under the directory <code>/mnt/data/application_name</code>. For instance, Traefik&#x27;s persistent data can reside in any subdirectory within /mnt/data. However, it is recommended to maintain a structured organization that suits your needs for better management and accessibility.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="secrets">Secrets<a href="#secrets" class="hash-link" aria-label="Direct link to Secrets" title="Direct link to Secrets">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="infrastructure-secrets">Infrastructure secrets<a href="#infrastructure-secrets" class="hash-link" aria-label="Direct link to Infrastructure secrets" title="Direct link to Infrastructure secrets">​</a></h3>
<p>All secrets, except those use by the containers are storeed as <a href="/kickstart-selfhosted-pages/Preparation/Github#github-secret">repository secrets in Github</a>, so they can be consumed during the execution of the pipeline.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="application-specific-secrets">Application specific secrets<a href="#application-specific-secrets" class="hash-link" aria-label="Direct link to Application specific secrets" title="Direct link to Application specific secrets">​</a></h3>
<p>Secrets that need to be used inside the containers are stored as external secrets at <a href="https://infisical.com/" target="_blank" rel="noopener noreferrer">infisical</a>.
All secrets that are stored in the root directory of infisical are going to be stored in the VPS in an <code>.env</code> file along with the root <code>docker-compose.yaml</code> . That way those secrets will be available to all containers as environment variables.
<img decoding="async" loading="lazy" src="/kickstart-selfhosted-pages/assets/images/infisical-root-secrets-aa5f859a5c6c87372527494eae57f9b4.png" width="961" height="540" class="img_ev3q"></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── docker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">compose.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── .env </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#This file will contain the secrets highlighted above</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── traefik</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   └── docker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">compose.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└── uptime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    └── docker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">compose.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Downloading the secrets and storing them in the <code>.env</code> file is done by the deployr script and this action is executed periodically.</p></div></div>
<p>All secrets stored in Infisical under the <code>traefik</code> directory will be copied to the file <code>./traefik/.secrets</code>, making them accessible to the Traefik containers as defined in <code>./traefik/docker-compose.yaml</code>.
<img decoding="async" loading="lazy" src="/kickstart-selfhosted-pages/assets/images/infisical-traefik-secret-ce72bf241eaa52e0627d1ea55173c1a8.png" width="961" height="540" class="img_ev3q"></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── docker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">compose.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── .env</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── traefik</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   ├── docker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">compose.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   └── .secrets </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#This file will contain the secrets highlighted above</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└── uptime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    └── docker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">compose.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>To create a <code>.secrets</code> file for each application, we can create a corresponding directory in Infisical with the same name. For example, to create a <code>.secrets</code> file for the <code>uptime</code> application, we need to create an <code>uptime</code> directory in Infisical and store the relevant secrets there. These secrets will then be saved in the file <code>./uptime/.secrets</code>.</p></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/kickstart-selfhosted-pages/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/kickstart-selfhosted-pages/costs"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Costs</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#general-idea" class="table-of-contents__link toc-highlight">General idea</a></li><li><a href="#containers-deployment" class="table-of-contents__link toc-highlight">Containers Deployment</a><ul><li><a href="#deployr-script" class="table-of-contents__link toc-highlight">Deployr script</a></li><li><a href="#docker-compose-structure" class="table-of-contents__link toc-highlight">Docker-compose structure</a></li></ul></li><li><a href="#persistent-storage" class="table-of-contents__link toc-highlight">Persistent Storage</a></li><li><a href="#secrets" class="table-of-contents__link toc-highlight">Secrets</a><ul><li><a href="#infrastructure-secrets" class="table-of-contents__link toc-highlight">Infrastructure secrets</a></li><li><a href="#application-specific-secrets" class="table-of-contents__link toc-highlight">Application specific secrets</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>