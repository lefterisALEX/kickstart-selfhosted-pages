<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Getting_Started/preparation/cloudflare" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">DNS &amp; TLS certificates | KickstartSelfhostedServices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lefterisALEX.github.io/kickstart-selfhosted-pages/img/&lt;open-graph-card&gt;"><meta data-rh="true" name="twitter:image" content="https://lefterisALEX.github.io/kickstart-selfhosted-pages/img/&lt;open-graph-card&gt;"><meta data-rh="true" property="og:url" content="https://lefterisALEX.github.io/kickstart-selfhosted-pages/Getting_Started/preparation/cloudflare"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="DNS &amp; TLS certificates | KickstartSelfhostedServices"><meta data-rh="true" name="description" content="We are using Cloudflare to manage the DNS zone and Let&#x27;s Encrypt for managing the TLS certificates. The following guide is going though the required steps that you will need before you first run your pipeline to deploy your selfhosted services."><meta data-rh="true" property="og:description" content="We are using Cloudflare to manage the DNS zone and Let&#x27;s Encrypt for managing the TLS certificates. The following guide is going though the required steps that you will need before you first run your pipeline to deploy your selfhosted services."><link data-rh="true" rel="icon" href="/kickstart-selfhosted-pages/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lefterisALEX.github.io/kickstart-selfhosted-pages/Getting_Started/preparation/cloudflare"><link data-rh="true" rel="alternate" href="https://lefterisALEX.github.io/kickstart-selfhosted-pages/Getting_Started/preparation/cloudflare" hreflang="en"><link data-rh="true" rel="alternate" href="https://lefterisALEX.github.io/kickstart-selfhosted-pages/Getting_Started/preparation/cloudflare" hreflang="x-default"><link rel="stylesheet" href="/kickstart-selfhosted-pages/assets/css/styles.76118980.css">
<script src="/kickstart-selfhosted-pages/assets/js/runtime~main.94aa18cd.js" defer="defer"></script>
<script src="/kickstart-selfhosted-pages/assets/js/main.84590a14.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/kickstart-selfhosted-pages/"><b class="navbar__title text--truncate">Kickstart Selfhosted Services</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" sidebarid="docsSidebar" href="/kickstart-selfhosted-pages/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/lefterisALEX/kickstart-selfhosted-pages" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kickstart-selfhosted-pages/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kickstart-selfhosted-pages/how_it_works">How it works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kickstart-selfhosted-pages/costs">Cloud Costs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/kickstart-selfhosted-pages/category/getting-started">Getting Started</a><button aria-label="Collapse sidebar category &#x27;Getting Started&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/kickstart-selfhosted-pages/category/preparation">Preparation</a><button aria-label="Collapse sidebar category &#x27;Preparation&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kickstart-selfhosted-pages/Getting_Started/preparation/cicd">CICD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kickstart-selfhosted-pages/Getting_Started/preparation/cloud_provider">Cloud Provider</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kickstart-selfhosted-pages/Getting_Started/preparation/vpn">VPN</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kickstart-selfhosted-pages/Getting_Started/preparation/terraform_state">Terraform State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/kickstart-selfhosted-pages/Getting_Started/preparation/cloudflare">DNS &amp; TLS certificates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kickstart-selfhosted-pages/Getting_Started/preparation/external_secrets">External Secrets</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kickstart-selfhosted-pages/Getting_Started/configuration_options">Configuration Options</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kickstart-selfhosted-pages/Getting_Started/deploy">Initial Deploy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kickstart-selfhosted-pages/Getting_Started/add-new-services">Add more services</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kickstart-selfhosted-pages/category/how-to">How to</a><button aria-label="Expand sidebar category &#x27;How to&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kickstart-selfhosted-pages/common-issues">Common Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kickstart-selfhosted-pages/faq">FAQ</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/kickstart-selfhosted-pages/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/kickstart-selfhosted-pages/category/getting-started"><span itemprop="name">Getting Started</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/kickstart-selfhosted-pages/category/preparation"><span itemprop="name">Preparation</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">DNS &amp; TLS certificates</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>DNS &amp; TLS certificates</h1></header>
<p>We are using Cloudflare to manage the DNS zone and Let&#x27;s Encrypt for managing the TLS certificates. The following guide is going though the required steps that you will need before you first run your pipeline to deploy your selfhosted services.</p>
<p>To complete this step you will need to have a domain (or subdomain) with an A record pointing to your Private IP of your hetzner server.
Additionally LetsEncrypt is managing the rotation of the TLS certificate , using DNS challenge.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>A cheap option for domains is to get a numbers only xyz domain, for example 123456.xyz, this cost less of a Euro per year.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-a-domain">Add a domain<a href="#add-a-domain" class="hash-link" aria-label="Direct link to Add a domain" title="Direct link to Add a domain">​</a></h3>
<p>In the account home page select <code>add a domain</code>.</p>
<p><img decoding="async" loading="lazy" src="/kickstart-selfhosted-pages/assets/images/cloudflare-add-domain-7ecaae6aca1feb825d5c84945173d5a2.png" width="1270" height="471" class="img_ev3q"></p>
<p>And then select to <strong>Manually enter DNS records</strong>
<img decoding="async" loading="lazy" src="/kickstart-selfhosted-pages/assets/images/cloudflare-1-4a42d68f1be6faf3da3b378ab156c8e6.png" width="1270" height="923" class="img_ev3q"></p>
<p>Enter a <a href="https://developers.cloudflare.com/dns/manage-dns-records/reference/wildcard-dns-records/#create-a-wildcard-record" target="_blank" rel="noopener noreferrer">wildcard DNS</a> A record to point to the private IP of the virtual machine in Hetzner.</p>
<p><strong>Type:</strong> <code>A</code><br>
<strong>Name:</strong> <code>*</code><br>
<strong>Content:</strong> <code>192.168.156.100</code><br>
<strong>Proxy Status:</strong> Disabled</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The default IP is <code>192.168.156.100</code> , if you have changed that you need to set the new IP here.</p></div></div>
<p><img decoding="async" loading="lazy" src="/kickstart-selfhosted-pages/assets/images/cloudflare-dns-48c63c79c54cefbe65ba933e8b841b91.png" width="1262" height="925" class="img_ev3q"></p>
<p>You will see now very likely that the domain is pending activation. This is because you have acquired the domain from a different registar and not Cloudflare.</p>
<p><img decoding="async" loading="lazy" src="/kickstart-selfhosted-pages/assets/images/cloudflare-pending-activation-3f16db522dfea9b72d0388c3a54f6f4b.png" width="1270" height="923" class="img_ev3q"></p>
<p>You will need to go to your domain registar and update the nameservers to use the Cloudflare Nameservers.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">alexa.ns.cloudflare.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">jack.ns.cloudflare.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In <a href="https://developers.cloudflare.com/dns/nameservers/update-nameservers/#your-domain-uses-a-different-registrar" target="_blank" rel="noopener noreferrer">this</a> page you can find information how to change the Nameservers in a list of domain registars.</p>
<p>Below an example of the required change in case you purchased the domain through <a href="https://www.namecheap.com/" target="_blank" rel="noopener noreferrer">namecheap.com</a>.</p>
<p><img decoding="async" loading="lazy" src="/kickstart-selfhosted-pages/assets/images/namecheap-ns-7079395dee016e35e5692a56362d86eb.png" width="1090" height="847" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="generate-api-key">Generate API key<a href="#generate-api-key" class="hash-link" aria-label="Direct link to Generate API key" title="Direct link to Generate API key">​</a></h2>
<p><strong>Why we need that?</strong><br>
<!-- -->In our setup we are using Let&#x27;s Encrypt to get certificates. Let&#x27;s Encypt servers need to verify first that you own the domain before they provide you the signed certificate.<br>
<!-- -->This can be done with <a href="https://letsencrypt.org/docs/challenge-types/" target="_blank" rel="noopener noreferrer">three methods</a>.</p>
<ol>
<li>HTTP challenge</li>
<li>DNS challenge</li>
<li>TLS-SNI</li>
</ol>
<p>We will be utilizing the DNS challenge, which requires our reverse proxy (Traefik) to have permissions to create TXT records in Cloudflare for your domain. To facilitate this, we will generate an API key with the necessary permissions. In the subsequent step, we will configure this API key as an external secret, allowing it to be accessed by the Traefik container.</p>
<p>To create an API token with the following permissions for your zone.</p>
<ol>
<li>Go to Profile -&gt; API Tokens -&gt; Create Token -&gt; Create Token -&gt; Create Custom Token</li>
</ol>
<p><img decoding="async" loading="lazy" src="/kickstart-selfhosted-pages/assets/images/clouflare-create-token-1-46ff000ff07c321f4057d4cd1720841e.png" width="1417" height="845" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="/kickstart-selfhosted-pages/assets/images/cloudflare-create-token-2-7b5a3afb2c5df183b7e6fede833bc2b8.png" width="1415" height="927" class="img_ev3q"></p>
<ol start="2">
<li>Add the following permissions:<br>
<code>Zone -&gt; Zone -&gt; Read</code> &amp; <code>Zone -&gt; DNS -&gt; Edit</code> .<br>
<!-- -->Then select specific zone  and select your domain and press <strong>Continue to Summary</strong>.</li>
</ol>
<p><img decoding="async" loading="lazy" src="/kickstart-selfhosted-pages/assets/images/clouflare-token-3-ea9ea9ba356a0126c2d5adc39e6905bc.png" width="1260" height="937" class="img_ev3q"></p>
<ol start="3">
<li>Copy the generated API token , you will need it for the next step where you create the external secrets.</li>
</ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/kickstart-selfhosted-pages/Getting_Started/preparation/terraform_state"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Terraform State</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/kickstart-selfhosted-pages/Getting_Started/preparation/external_secrets"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">External Secrets</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#add-a-domain" class="table-of-contents__link toc-highlight">Add a domain</a></li><li><a href="#generate-api-key" class="table-of-contents__link toc-highlight">Generate API key</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>