"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[216],{2072:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/infisical-add-client-secret-ee5b47cb5d129e8bbfaebc18583d9d79.png"},3489:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/infisical-client-id-10b9455e908d5f313a70e280a5394a4a.png"},3567:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"Preparation/Infisical","title":"External Secrets - Infisical","description":"We are using Infisical to securely store all secrets related to your applications. Those secrets are pulled periodically (every 3 minutes) and can be used from the containers.","source":"@site/docs/Preparation/Infisical.md","sourceDirName":"Preparation","slug":"/Preparation/Infisical","permalink":"/kickstart-selfhosted-pages/Preparation/Infisical","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"defaultSidebar","previous":{"title":"DNS & TLS certificates - Cloudflare/Let\'s Encrypt","permalink":"/kickstart-selfhosted-pages/Preparation/Cloudflare"},"next":{"title":"Configuration Options","permalink":"/kickstart-selfhosted-pages/configuration-options"}}');var t=r(4848),i=r(8453);const a={sidebar_position:6},c="External Secrets - Infisical",o={},d=[{value:"Create a Project",id:"create-a-project",level:2},{value:"Create Identity",id:"create-identity",level:2},{value:"Add secrets",id:"add-secrets",level:2},{value:"Application specific secrets",id:"application-specific-secrets",level:3},{value:"Common variables",id:"common-variables",level:3}];function l(e){const s={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"external-secrets---infisical",children:"External Secrets - Infisical"})}),"\n",(0,t.jsxs)(s.p,{children:["We are using ",(0,t.jsx)(s.a,{href:"https://infisical.com/",children:"Infisical"})," to securely store all secrets related to your applications. Those secrets are pulled periodically (every 3 minutes) and can be used from the containers."]}),"\n",(0,t.jsx)(s.h2,{id:"create-a-project",children:"Create a Project"}),"\n",(0,t.jsxs)(s.p,{children:["First thing is that we need to create a new project and save the project ID as github secret with name ",(0,t.jsx)(s.code,{children:"INFISICAL_PROJECT_ID"}),"\n",(0,t.jsx)(s.img,{src:r(5205).A+"",width:"1638",height:"919"})]}),"\n",(0,t.jsx)(s.h2,{id:"create-identity",children:"Create Identity"}),"\n",(0,t.jsxs)(s.p,{children:["Navigate to ",(0,t.jsx)(s.code,{children:"Admin"})," -> ",(0,t.jsx)(s.code,{children:"Access Control"})," -> ",(0,t.jsx)(s.code,{children:"Identities"})," .",(0,t.jsx)(s.br,{}),"\n","Press ",(0,t.jsx)(s.strong,{children:'"Create Identity"'})," and select as ",(0,t.jsx)(s.strong,{children:'"Member"'})," as Role\n",(0,t.jsx)(s.img,{src:r(8427).A+"",width:"1638",height:"919"})]}),"\n",(0,t.jsxs)(s.p,{children:["Then press ",(0,t.jsx)(s.code,{children:"Universal Auth"})," and after press ",(0,t.jsx)(s.code,{children:"Add client secret"})," , give it a name and press ",(0,t.jsx)(s.strong,{children:'"Create"'}),". Save the generated client secret as github secret with name ",(0,t.jsx)(s.code,{children:"INFISICAL_CLIENT_SECRET"}),"\n",(0,t.jsx)(s.img,{src:r(8676).A+"",width:"1631",height:"919"}),"\n",(0,t.jsx)(s.img,{src:r(2072).A+"",width:"1631",height:"919"}),"\n",(0,t.jsx)(s.img,{src:r(3979).A+"",width:"1631",height:"919"})]}),"\n",(0,t.jsxs)(s.p,{children:["Copy the ",(0,t.jsx)(s.code,{children:"Client ID"})," and save it as github secret with name ",(0,t.jsx)(s.code,{children:"INFISICAL_CLIENT_ID"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{src:r(3489).A+"",width:"1631",height:"919"})]}),"\n",(0,t.jsx)(s.p,{children:"Now you should have 3 new secrets stored in github related with Infisical."}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{src:r(9452).A+"",width:"1631",height:"919"})}),"\n",(0,t.jsxs)(s.p,{children:["Lastly assign the new identity as Project Viewer\n",(0,t.jsx)(s.img,{src:r(9069).A+"",width:"1631",height:"919"}),"\n",(0,t.jsx)(s.img,{src:r(8742).A+"",width:"1631",height:"919"})]}),"\n",(0,t.jsx)(s.h2,{id:"add-secrets",children:"Add secrets"}),"\n",(0,t.jsxs)(s.p,{children:["Is important first to understand how the secrets are copied in to the VPS first.",(0,t.jsx)(s.br,{}),"\n","Below a structure of the folder containers our applications."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"\u251c\u2500\u2500 docker-compose.yaml\n\u251c\u2500\u2500 adguard\n\u2502   \u2514\u2500\u2500 docker-compose.yaml\n\u251c\u2500\u2500 docker-backup\n\u2502   \u2514\u2500\u2500 docker-compose.yaml\n\u251c\u2500\u2500 traefik\n\u2502   \u2514\u2500\u2500 docker-compose.yaml\n\u2514\u2500\u2500 uptime\n    \u2514\u2500\u2500 docker-compose.yaml\n"})}),"\n",(0,t.jsxs)(s.p,{children:["In this structure there is a main ",(0,t.jsx)(s.code,{children:"docker-compose.yaml"})," file which is used to configure:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Which other ",(0,t.jsx)(s.code,{children:"docker-compose.yaml"})," files should be included, so in other words which other services should be enabled."]}),"\n",(0,t.jsx)(s.li,{children:"The docker network name and subnet."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"example of a root docker-compose.yaml file"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'version: "3"\ninclude:\n  - ./traefik/docker-compose.yaml\n  - ./docker-backup/docker-compose.yaml\n  - ./dashy/docker-compose.yaml\n  - ./uptime/docker-compose.yaml\nnetworks:\n  private_network:\n    name: private_network\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.29.1.0/24\n'})}),"\n",(0,t.jsxs)(s.p,{children:["All applications then have their own dedicated  ",(0,t.jsx)(s.code,{children:"docker-compose.yaml"})," file under a specific directory.",(0,t.jsx)(s.br,{}),"\n","For instance for the traefik application the ",(0,t.jsx)(s.code,{children:"docker-compose.yaml"})," is the ",(0,t.jsx)(s.code,{children:"traefik/docker-compose.yaml"})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'version: "3.8"\n\nname: traefik\n\nservices:\n  traefik:\n    image: traefik:v3.3\n    container_name: traefik\n    ports:\n      - 80:80\n      - 443:443\n      - 8080:8080\n    networks:\n      private_network:\n    env_file:\n      - .secrets\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n      - /mnt/data/traefik/letsencrypt:/letsencrypt\n    command:\n      - "--api=true"\n      - "--api.dashboard=true"\n      - "--providers.docker=true"\n      - "--providers.docker.exposedbydefault=false"\n      - "--entrypoints.web.address=:80"\n      - "--entrypoints.websecure.address=:443"\n      - "--entrypoints.web.http.redirections.entryPoint.to=websecure"\n      - "--certificatesresolvers.letsencrypt.acme.dnschallenge=true"\n      - "--certificatesresolvers.letsencrypt.acme.dnschallenge.provider=cloudflare"\n      - "--certificatesresolvers.letsencrypt.acme.email=${EMAIL}"\n      - "--certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json"\n    labels:\n      - "traefik.enable=true"\n      - "traefik.http.routers.dashboard.entrypoints=websecure"\n      - "traefik.http.routers.dashboard.tls.certresolver=letsencrypt"\n      - "traefik.http.routers.dashboard.rule=Host(`dashboard.${DOMAIN}`) && (PathPrefix(`/api`) || PathPrefix(`/dashboard`))"\n      - "traefik.http.routers.dashboard.service=api@internal"\n    restart: always\n'})}),"\n",(0,t.jsx)(s.h3,{id:"application-specific-secrets",children:"Application specific secrets"}),"\n",(0,t.jsxs)(s.p,{children:["In the above ",(0,t.jsx)(s.code,{children:"docker-compose.yaml"})," for traefik we see that there are some environment variables used, ",(0,t.jsx)(s.code,{children:"${DOMAIN}"})," and ",(0,t.jsx)(s.code,{children:"${EMAIL}"})," . There is also a ",(0,t.jsx)(s.code,{children:"env_file"})," read from the file ",(0,t.jsx)(s.code,{children:".secrets"}),".\nThe way how it works is that when the deployr script is executed is going to pull all secrets from infisical and place them under the same directory as defined in infisical.",(0,t.jsx)(s.br,{}),"\n","So all secrets stored in infisical under the directory traefik, are going to be copied to the file ",(0,t.jsx)(s.code,{children:"./traefik/.secrets"})," and thus available to the containers traefik as defined in ",(0,t.jsx)(s.code,{children:"./traefik/docker-compose.yaml"})]}),"\n",(0,t.jsx)(s.h3,{id:"common-variables",children:"Common variables"}),"\n",(0,t.jsx)(s.p,{children:"In addition any secrets stored in the root directory in infisical will be available as variables accross all containers."})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},3979:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/infisical-create-client-secret-5a097144cc22f30e5ba6bcfddd10dc92.png"},5205:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/infisical-project-id-8e30279cbc39cf7b26a77e3873d8ebb4.png"},8427:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/infisical-create-identity-3339ad9d7ba485e20c35a1fa371c0b8b.png"},8453:(e,s,r)=>{r.d(s,{R:()=>a,x:()=>c});var n=r(6540);const t={},i=n.createContext(t);function a(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),n.createElement(i.Provider,{value:s},e.children)}},8676:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/infisical-universal-auth-697ed9dc488f9bd34908672001589876.png"},8742:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/infisical-project-2-046666f80f3ab62a49b0a7ada396efdd.png"},9069:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/infisical-project-1-1eabfee1b67781aad8034c808e53e921.png"},9452:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/github-infisical-client-secret-a5cb33490cf0a7a352708ea09a744537.png"}}]);