"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[59],{727:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"add-new-service","title":"Add more services","description":"You can include any docker-compose.yaml file in your apps directory if you want to inlude it in the stack. There are some steps you will need to be aware you need to do in order to run properly.","source":"@site/docs/add-new-service.md","sourceDirName":".","slug":"/add-new-service","permalink":"/kickstart-selfhosted-pages/add-new-service","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"defaultSidebar","previous":{"title":"Initial Deploy","permalink":"/kickstart-selfhosted-pages/initial-deploy"},"next":{"title":"How to","permalink":"/kickstart-selfhosted-pages/category/how-to"}}');var r=s(4848),i=s(8453);const o={sidebar_position:7},a="Add more services",l={},c=[{value:"update the root docker-compose",id:"update-the-root-docker-compose",level:2},{value:"Update the volumes",id:"update-the-volumes",level:2},{value:"Update Network",id:"update-network",level:2},{value:"Add the traefik labels",id:"add-the-traefik-labels",level:2},{value:"Add the backup labels",id:"add-the-backup-labels",level:2},{value:"Include the secrets file",id:"include-the-secrets-file",level:2},{value:"Access the new service",id:"access-the-new-service",level:2}];function d(e){const t={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"add-more-services",children:"Add more services"})}),"\n",(0,r.jsxs)(t.p,{children:["You can include any ",(0,r.jsx)(t.code,{children:"docker-compose.yaml"})," file in your apps directory if you want to inlude it in the stack. There are some steps you will need to be aware you need to do in order to run properly.",(0,r.jsx)(t.br,{}),"\n","You will have to:"]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"update the root docker-compose.yaml"})," to include the new ",(0,r.jsx)(t.code,{children:"docker-compose"})," file."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Update the volumes"})," of the docker-compose to point to a path under ",(0,r.jsx)(t.code,{children:"/mnt/data"})," if you want your data to be persistant."]}),"\n",(0,r.jsxs)(t.li,{children:["Add the ",(0,r.jsxs)(t.strong,{children:["containers to the ",(0,r.jsx)(t.code,{children:"private_network"})]})," so is in the same network as the other containers."]}),"\n",(0,r.jsxs)(t.li,{children:["Add the ",(0,r.jsx)(t.strong,{children:"traefik labels"})," if you want to expose your service."]}),"\n",(0,r.jsxs)(t.li,{children:["Add the ",(0,r.jsx)(t.strong,{children:"docker-volume-backup labels"})," if you want the container to be stopped when the backup is taken"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsxs)(t.strong,{children:["Include the ",(0,r.jsx)(t.code,{children:".secrets"})," file"]}),", if you want to read the secrets from infisical an environment variables."]}),"\n"]}),"\n",(0,r.jsx)(t.admonition,{type:"tip",children:(0,r.jsxs)(t.p,{children:["A very good starting point to find docker-compose.yaml files for almost any service you want to self host is the ",(0,r.jsx)(t.a,{href:"https://github.com/awesome-selfhosted/awesome-selfhosted",children:"awesome-selfhosted"})," repository."]})}),"\n",(0,r.jsxs)(t.p,{children:["As an example let's say we want to deploy ",(0,r.jsx)(t.strong,{children:"uptime-kuma"})," based on the ",(0,r.jsx)(t.code,{children:"docker-compose.yaml"})," as found in uptime github ",(0,r.jsx)(t.a,{href:"https://github.com/louislam/uptime-kuma/blob/master/compose.yaml",children:"repository"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"services:\n  uptime-kuma:\n    image: louislam/uptime-kuma:1\n    volumes:\n      - ./data:/app/data\n    ports:\n      # <Host Port>:<Container Port>\n      - 3001:3001\n    restart: unless-stopped\n"})}),"\n",(0,r.jsxs)(t.p,{children:["We need first to place this file under ",(0,r.jsx)(t.code,{children:"containers-host/apps/uptime/docker-compose.yaml"})," file. The new structure should look now like:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"\u251c\u2500\u2500 docker-compose.yaml\n\u251c\u2500\u2500 .env \n\u251c\u2500\u2500 traefik\n\u2502   \u2514\u2500\u2500 docker-compose.yaml\n\u251c\u2500\u2500 uptime\n\u2502   \u2514\u2500\u2500 docker-compose.yaml\n\u2514\u2500\u2500 docker-backup\n    \u2514\u2500\u2500 docker-compose.yaml\n\n"})}),"\n",(0,r.jsx)(t.h2,{id:"update-the-root-docker-compose",children:"update the root docker-compose"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'version: "3"\ninclude:\n  - ./traefik/docker-compose.yaml\n  - ./docker-backup/docker-compose.yaml\n  # Add the line below to include the uptime-kuma docker-compose\n  - ./uptime/docker-compose.yaml\nnetworks:\n  private_network:\n    name: private_network\n    driver: bridge \n    ipam:\n      config:\n        - subnet: 172.29.1.0/24\n'})}),"\n",(0,r.jsx)(t.h2,{id:"update-the-volumes",children:"Update the volumes"}),"\n",(0,r.jsxs)(t.p,{children:["The config volume is the one we want to store in the persistant data. So we are going to update the ",(0,r.jsx)(t.code,{children:"docker-compose.yaml"})," to look like:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"services:\n  uptime-kuma:\n    image: louislam/uptime-kuma:1\n    volumes:\n      - /mnt/data/uptime:/app/data\n    ports:\n      # <Host Port>:<Container Port>\n      - 3001:3001\n    restart: unless-stopped\n"})}),"\n",(0,r.jsx)(t.h2,{id:"update-network",children:"Update Network"}),"\n",(0,r.jsx)(t.p,{children:"We need to update the network so uptime-kuma container is running in the same network with the rest containers."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"services:\n  uptime-kuma:\n    image: louislam/uptime-kuma:1\n    volumes:\n      - /mnt/data/uptime:/app/data\n    ports:\n      # <Host Port>:<Container Port>\n      - 3001:3001\n    networks:\n      - private_network\n    restart: unless-stopped\n"})}),"\n",(0,r.jsx)(t.h2,{id:"add-the-traefik-labels",children:"Add the traefik labels"}),"\n",(0,r.jsx)(t.p,{children:"To configure Traefik to route HTTPS traffic to the uptime-kuma service based on the specified host (uptime.your-domain), while also managing TLS certificates automatically through Let's Encrypt we need to add the following labels:"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"traefik.enable"}),": This label enables Traefik for the uptime-kuma service. If this label is set to false, Traefik will ignore this service.\n",(0,r.jsx)(t.strong,{children:"traefik.http.routers.uptime.entrypoints"}),": This label specifies that the router for this service should listen on the websecure entry point.\n",(0,r.jsx)(t.strong,{children:"traefik.http.routers.uptime.rule"}),": It tells Trafik which domain requests to route to uptime-kuma services. If ",(0,r.jsx)(t.code,{children:"${DOMAIN}"})," is example.com, then is going to route all requests to ",(0,r.jsx)(t.code,{children:"uptime.example.com"})," to uptime-kuma service\n",(0,r.jsx)(t.strong,{children:"traefik.http.routers.uptime.tls.certresolver"}),": This label indicates which resolved Traefik should use to automatically obtain and manage TLS certificates for this service.\n",(0,r.jsx)(t.strong,{children:"traefik.http.routers.uptime.tls"}),": If true it explicitly enables TLS for the router, ensuring that the service is served over HTTPS."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'services:\n  uptime-kuma:\n    image: louislam/uptime-kuma:1\n    labels:\n      - "traefik.enable=true"\n      - "traefik.http.routers.uptime.entrypoints=websecure"\n      - "traefik.http.routers.uptime.rule=Host(`uptime.${DOMAIN}`)"\n      - "traefik.http.routers.uptime.tls.certresolver=letsencrypt"\n      - "traefik.http.routers.uptime.tls=true"\n    volumes:\n      - /mnt/data/uptime:/app/data\n    networks:\n      - private_network\n    restart: unless-stopped\n'})}),"\n",(0,r.jsx)(t.h2,{id:"add-the-backup-labels",children:"Add the backup labels"}),"\n",(0,r.jsxs)(t.p,{children:["Since we are running already the docker-volume-backup container by default we might want to stop the containers when the backup is taken to ensure that backup integrity.",(0,r.jsx)(t.br,{}),"\n","To do that we can add the following label:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'      - "docker-volume-backup.stop-during-backup=true"\n'})}),"\n",(0,r.jsx)(t.p,{children:"The file should look now like this:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'services:\n  uptime-kuma:\n    image: louislam/uptime-kuma:1\n    labels:\n      - "docker-volume-backup.stop-during-backup=true"\n      - "traefik.enable=true"\n      - "traefik.http.routers.uptime.entrypoints=websecure"\n      - "traefik.http.routers.uptime.rule=Host(`uptime.${DOMAIN}`)"\n      - "traefik.http.routers.uptime.tls.certresolver=letsencrypt"\n      - "traefik.http.routers.uptime.tls=true"\n    volumes:\n      - /mnt/data/uptime:/app/data\n    networks:\n      - private_network\n    restart: unless-stopped\n'})}),"\n",(0,r.jsx)(t.h2,{id:"include-the-secrets-file",children:"Include the secrets file"}),"\n",(0,r.jsxs)(t.p,{children:["In some containers, it may be necessary to inject secrets, such as credentials for connecting to a database. There are various methods to achieve this, and in our case, we are utilizing Infisical to manage these secrets. The deployr script will retrieve the credentials stored in Infisical and create a file named ",(0,r.jsx)(t.code,{children:".secrets"})," in the same directory as the ",(0,r.jsx)(t.code,{children:"docker-compose.yaml"})," file for the uptime-kuma service.\nTo begin, we need to add the required secrets to Infisical under a new directory ",(0,r.jsx)(t.code,{children:"uptime"}),"."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:s(6222).A+"",width:"1584",height:"507"})}),"\n",(0,r.jsxs)(t.p,{children:["The deployr script will then access all secrets within this ",(0,r.jsx)(t.code,{children:"uptime"})," directory and generate the ",(0,r.jsx)(t.code,{children:".secrets"})," file in the ",(0,r.jsx)(t.code,{children:"uptime"})," subdirectory of the apps directory, which is the same location as the uptime-kuma ",(0,r.jsx)(t.code,{children:"docker-compose.yaml"})," file."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"\u251c\u2500\u2500 docker-compose.yaml\n\u251c\u2500\u2500 .env \n\u251c\u2500\u2500 traefik\n\u2502   \u2514\u2500\u2500 docker-compose.yaml\n\u251c\u2500\u2500 uptime\n\u2502   \u251c\u2500\u2500 docker-compose.yaml\n\u2502   \u2514\u2500\u2500 .secrets # This file will contain the secrets for the uptime service\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Once the ",(0,r.jsx)(t.code,{children:".secrets"})," file is created, the ",(0,r.jsx)(t.code,{children:"env_file"})," directive in the ",(0,r.jsx)(t.code,{children:"docker-compose.yaml"})," can be used to make these key-value pairs available as environment variables within the container."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'services:\n  uptime-kuma:\n    image: louislam/uptime-kuma:1\n    env_file:\n      - .secrets\n    labels:\n      - "docker-volume-backup.stop-during-backup=true"\n      - "traefik.enable=true"\n      - "traefik.http.routers.uptime.entrypoints=websecure"\n      - "traefik.http.routers.uptime.rule=Host(`uptime.${DOMAIN}`)"\n      - "traefik.http.routers.uptime.tls.certresolver=letsencrypt"\n      - "traefik.http.routers.uptime.tls=true"\n    volumes:\n      - /mnt/data/uptime:/app/data\n    networks:\n      - private_network\n    restart: unless-stopped\n'})}),"\n",(0,r.jsx)(t.h2,{id:"access-the-new-service",children:"Access the new service"}),"\n",(0,r.jsx)(t.p,{children:"Once the changes are committed to the repository, the deployr script will automatically detect the new commit during its next run and pull the updated code to the VPS. After the code is successfully pulled, deployr will execute the command docker-compose up to deploy the updated service, Uptime Kuma."}),"\n",(0,r.jsxs)(t.p,{children:["To verify that the new service has been deployed, simply navigate to ",(0,r.jsx)(t.code,{children:"https://uptime.<your-domain>"})," in your browser. For example, if your domain is ",(0,r.jsx)(t.code,{children:"238749.xyz"}),", you should be able to access the login page of Uptime Kuma at ",(0,r.jsx)(t.code,{children:"https://uptime.238749.xyz"}),"."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:s(6257).A+"",width:"1284",height:"800"})})]})}function u(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},6222:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/infisical-uptime-613763b6dcb93db762964b4f9a3c4e01.png"},6257:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/uptime-login-8335f74628912aa4a98eeafb3a4809df.png"},8453:(e,t,s)=>{s.d(t,{R:()=>o,x:()=>a});var n=s(6540);const r={},i=n.createContext(r);function o(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);